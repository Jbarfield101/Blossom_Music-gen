<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <title>ONNX Crafter</title>
  <script type="module" src="./theme.js"></script>
  <link rel="stylesheet" href="/ui/theme.css">
  <style>
    body { font-family: sans-serif; margin: 1em; background: var(--bg); color: var(--fg); }
    label { display: block; margin-bottom: 0.5em; }
    #log { background: var(--log-bg); color: var(--log-fg); padding: 0.5em; height: 200px; overflow-y: auto; }
    #loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      color: var(--fg);
    }
    #loading-overlay .spinner {
      border: 4px solid var(--fg);
      border-top: 4px solid transparent;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin-bottom: 1em;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <h1>ONNX Crafter</h1>
  <section id="instructions">
    <h2>Instructions</h2>
    <ol>
      <li>Download a piano phrase <code>.onnx</code> model into your local <code>models/</code> folder and select it below.</li>
      <li>Provide a song specification or melody seed, then tune the sampling parameters.</li>
      <li>Press <strong>Start</strong> to generate a new piano stem and watch the progress log.</li>
    </ol>
    <p>
      Need a model?
      <a href="../docs/phrase_models.md" target="_blank">
        Learn how to fetch and install <code>.onnx</code> models for piano stems
      </a>.
    </p>
  </section>
  <div id="inputs">
    <label>Model
      <select id="model-select" title="Choose a downloaded .onnx model">
        <option value="" disabled selected>Select a model...</option>
      </select>
    </label>
    <label>Song spec (JSON or space-separated chords)
      <textarea id="song_spec" rows="3"></textarea>
    </label>
    <label>Melody MIDI <input type="file" id="midi" title="Optional melody seed" /></label>
    <label>Steps <input type="number" id="steps" value="32" title="Total tokens to generate" /></label>
    <label>Top-k <input type="number" id="top_k" title="Keep the highest-probability k tokens" /></label>
    <label>Top-p <input type="number" step="0.01" id="top_p" title="Nucleus sampling probability threshold" /></label>
    <label>
      Temperature
      <input type="number" step="0.01" id="temperature" value="1.0" title="Scale logits before sampling" />
    </label>
  </div>
  <div id="controls">
    <button id="download" type="button">Download</button>
    <button id="start" type="button" disabled>Start</button>
    <button id="cancel" type="button" disabled>Cancel</button>
    <progress id="progress" value="0" max="100"></progress>
    <span id="eta"></span>
  </div>
  <pre id="log"></pre>
  <div id="results" hidden>
    <h3>Result</h3>
    <a id="midi_link" href="#"></a>
    <pre id="telemetry"></pre>
  </div>
  <div id="loading-overlay" hidden>
    <div class="spinner" aria-hidden="true"></div>
    <p>ONNX is loading, searching for MusicLang modelsâ€¦</p>
  </div>
  <script type="module" src="./topbar.js"></script>
  <script src="/ui/onnx.js"></script>
</body>
</html>
