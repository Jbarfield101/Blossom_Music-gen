<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <title>ONNX Crafter</title>
  <script type="module" src="./theme.js"></script>
  <link rel="stylesheet" href="/ui/theme.css">
  <style>
    body { font-family: sans-serif; margin: 1em; background: var(--bg); color: var(--text); }
    label { display: block; margin-bottom: 0.5em; }
    #log { background: var(--log-bg); color: var(--log-fg); padding: 0.5em; height: 200px; overflow-y: auto; }
    #loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--overlay-bg);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      color: var(--text);
    }
    #loading-overlay .spinner {
      border: 4px solid var(--icon);
      border-top: 4px solid transparent;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin-bottom: 1em;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <h1>ONNX Crafter</h1>
  <section id="instructions">
    <h2>Instructions</h2>
    <ol>
      <li>Download a piano phrase <code>.onnx</code> model into your local <code>models/</code> folder and select it below.</li>
      <li>Provide a song specification or melody seed, then tune the sampling parameters.</li>
      <li>Press <strong>Start</strong> to generate a new piano stem and watch the progress log.</li>
    </ol>
    <p>
      Need a model?
      <a href="../docs/phrase_models.md" target="_blank">
        Learn how to fetch and install <code>.onnx</code> models for piano stems
      </a>.
    </p>
  </section>
  <div id="inputs">
    <label for="model-select">Model</label>
    <select id="model-select" title="Choose a downloaded .onnx model" aria-label="Model">
      <option value="" disabled selected>Select a model...</option>
    </select>

    <label for="song_spec">Song spec (JSON or space-separated chords)</label>
    <textarea id="song_spec" rows="3" aria-label="Song specification"></textarea>

    <label for="midi">Melody MIDI</label>
    <input type="file" id="midi" title="Optional melody seed" aria-label="Melody MIDI" />

    <label for="steps">Steps</label>
    <input type="number" id="steps" value="32" title="Total tokens to generate" aria-label="Steps" />

    <label for="top_k">Top-k</label>
    <input type="number" id="top_k" title="Keep the highest-probability k tokens" aria-label="Top-k" />

    <label for="top_p">Top-p</label>
    <input type="number" step="0.01" id="top_p" title="Nucleus sampling probability threshold" aria-label="Top-p" />

    <label for="temperature">Temperature</label>
    <input type="number" step="0.01" id="temperature" value="1.0" title="Scale logits before sampling" aria-label="Temperature" />
  </div>

  <div id="controls">
    <button id="download" type="button" aria-label="Download model">Download</button>
    <button id="start" type="button" disabled aria-label="Start generation">Start</button>
    <button id="cancel" type="button" disabled aria-label="Cancel generation">Cancel</button>
    <label for="progress">Progress</label>
    <progress id="progress" value="0" max="100" aria-label="Progress"></progress>
    <span id="eta" aria-live="polite"></span>
  </div>
  <pre id="log"></pre>
  <div id="results" hidden>
    <h3>Result</h3>
    <a id="midi_link" href="#" aria-label="Download generated MIDI"></a>
    <pre id="telemetry"></pre>
  </div>
  <div id="loading-overlay" hidden>
    <div class="spinner" aria-hidden="true"></div>
    <p>ONNX is loading, searching for MusicLang modelsâ€¦</p>
  </div>
  <script type="module" src="./topbar.js"></script>
  <script src="/ui/onnx.js"></script>
</body>
</html>
